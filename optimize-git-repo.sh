#!/bin/bash

# Перевірка, чи ми в Git-репозиторії
if [ ! -d ".git" ]; then
  echo "Помилка: Це не Git-репозиторій. Запустіть скрипт у папці з .git"
  exit 1
fi

echo "Початок оптимізації теки .git..."

# Крок 1: Видалення злитих гілок
echo "Видалення злитих гілок..."
git branch --merged | grep -v "\*" | xargs -n 1 git branch -d

# Крок 2: Очищення застарілих віддалених гілок
echo "Очищення віддалених гілок..."
git fetch --prune

# Крок 3: Очищення рефлогів
echo "Очищення рефлогів..."
git reflog expire --expire=now --all

# Крок 4: Збір сміття - !!! допомагає найбільше !!!
echo "Виконання збору сміття..."
git gc --prune=now --aggressive

# Крок 5: Перепакування об’єктів
echo "Перепакування об’єктів..."
git repack -a -d -l

# Перевірка розміру та кількості файлів після оптимізації
echo "Результати оптимізації:"
echo "Розмір теки .git:"
du -sh .git
echo "Кількість файлів у .git:"
find .git -type f | wc -l

echo "Оптимізація завершена!"